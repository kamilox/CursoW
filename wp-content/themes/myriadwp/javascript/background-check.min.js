!function(t,e){"function"==typeof define&&define.amd?define(e):t.BackgroundCheck=e()}(this,function(){"use strict";var t,e,i,n,o,a=void 0!==window.orientation?"orientationchange":"resize",r={};function g(){t=null,e=null,i=null,r={},n&&clearTimeout(n)}function l(t){W("debug")&&console.log(t)}function d(t,e){return h(t,typeof e),void 0===t?e:t}function h(t,e){if(void 0!==t&&typeof t!==e)throw"Incorrect attribute type"}function u(t,e){var i=t;if("string"==typeof t?i=document.querySelectorAll(t):t&&1===t.nodeType&&(i=[t]),!i||0===i.length||void 0===i.length)throw"Elements not found";return e&&(i=function(t){for(var e,i,n=[],o=0;o<t.length;o++)if(e=t[o],n.push(e),"IMG"!==e.tagName){if((i=window.getComputedStyle(e).backgroundImage).split(/,url|, url/).length>1)throw"Multiple backgrounds are not supported";if(!i||"none"===i)throw"Element is not an <img> but does not have a background-image";n[o]={img:new Image,el:n[o]},i=(i=i.slice(4,-1)).replace(/"/g,""),n[o].img.src=i,l("CSS Image - "+i)}return n}(i)),i=Array.prototype.slice.call(i)}function m(){W("debugOverlay")?(e.style.opacity=.5,e.style.pointerEvents="none",document.body.appendChild(e)):e.parentNode&&e.parentNode.removeChild(e)}function s(){o={left:0,top:0,right:document.body.clientWidth,bottom:window.innerHeight},e.width=document.body.clientWidth,e.height=window.innerHeight}function c(t,e,i){var n,o;return-1!==t.indexOf("px")?n=parseFloat(t):-1!==t.indexOf("%")?(n=(o=(n=parseFloat(t))/100)*e,i&&(n-=i*o)):n=e,n}function f(t){var e,i,n;if(t.nodeType){var o=t.getBoundingClientRect();e={left:o.left,right:o.right,top:o.top,bottom:o.bottom,width:o.width,height:o.height},n=t.parentNode,i=t}else e=function(t){var e=window.getComputedStyle(t.el);t.el.style.backgroundRepeat="no-repeat",t.el.style.backgroundOrigin="padding-box";var i=e.backgroundSize.split(" "),n=i[0],o=void 0===i[1]?"auto":i[1],a=t.el.clientWidth/t.el.clientHeight,r=t.img.naturalWidth/t.img.naturalHeight;"cover"===n?a>=r?(n="100%",o="auto"):(n="auto",i[0]="auto",o="100%"):"contain"===n&&(1/a<1/r?(n="auto",i[0]="auto",o="100%"):(n="100%",o="auto")),n="auto"===n?t.img.naturalWidth:c(n,t.el.clientWidth),o="auto"===o?n/t.img.naturalWidth*t.img.naturalHeight:c(o,t.el.clientHeight),"auto"===i[0]&&"auto"!==i[1]&&(n=o/t.img.naturalHeight*t.img.naturalWidth);var g,l,d=e.backgroundPosition;return"top"===d?d="50% 0%":"left"===d?d="0% 50%":"right"===d?d="100% 50%":"bottom"===d?d="50% 100%":"center"===d&&(d="50% 50%"),4===(d=d.split(" ")).length?(g=d[1],l=d[3]):(g=d[0],l=d[1]),l=l||"50%",g=c(g,t.el.clientWidth,n),l=c(l,t.el.clientHeight,o),4===d.length&&("right"===d[0]&&(g=t.el.clientWidth-t.img.naturalWidth-g),"bottom"===d[2]&&(l=t.el.clientHeight-t.img.naturalHeight-l)),g+=t.el.getBoundingClientRect().left,l+=t.el.getBoundingClientRect().top,{left:Math.floor(g),right:Math.floor(g+n),top:Math.floor(l),bottom:Math.floor(l+o),width:Math.floor(n),height:Math.floor(o)}}(t),n=t.el,i=t.img;n=n.getBoundingClientRect(),e.imageTop=0,e.imageLeft=0,e.imageWidth=i.naturalWidth,e.imageHeight=i.naturalHeight;var a,r=e.imageHeight/e.height;return e.top<n.top&&(a=n.top-e.top,e.imageTop=r*a,e.imageHeight-=r*a,e.top+=a,e.height-=a),e.left<n.left&&(a=n.left-e.left,e.imageLeft+=r*a,e.imageWidth-=r*a,e.width-=a,e.left+=a),e.bottom>n.bottom&&(a=e.bottom-n.bottom,e.imageHeight-=r*a,e.height-=a),e.right>n.right&&(a=e.right-n.right,e.imageWidth-=r*a,e.width-=a),e.imageTop=Math.floor(e.imageTop),e.imageLeft=Math.floor(e.imageLeft),e.imageHeight=Math.floor(e.imageHeight),e.imageWidth=Math.floor(e.imageWidth),e}function p(t,e,i){var n=t.className;switch(i){case"add":n+=" "+e;break;case"remove":var o=new RegExp("(?:^|\\s)"+e+"(?!\\S)","g");n=n.replace(o,"")}t.className=n.trim()}function v(t){for(var e,i=t?[t]:W("targets"),n=0;n<i.length;n++)e=i[n],p(e=W("changeParent")?e.parentNode:e,W("classes").light,"remove"),p(e,W("classes").dark,"remove"),p(e,W("classes").complex,"remove")}function w(t){var e,n,o,a=t.getBoundingClientRect(),r=0,g=0,d=0,h=0,u=W("mask");if(a.width>0&&a.height>0){v(t),t=W("changeParent")?t.parentNode:t,e=i.getImageData(a.left,a.top,a.width,a.height).data;for(var m=0;m<e.length;m+=4)e[m]===u.r&&e[m+1]===u.g&&e[m+2]===u.b?h++:(r++,g+=(n=.2126*e[m]+.7152*e[m+1]+.0722*e[m+2]-d)*n,d+=n/r);h<=e.length/4*(1-W("minOverlap")/100)&&(o=Math.sqrt(g/r)/255,d/=255,l("Target: "+t.className+" lum: "+d+" var: "+o),p(t,d<=W("threshold")/100?W("classes").dark:W("classes").light,"add"),o>W("minComplexity")/100&&p(t,W("classes").complex,"add"))}}function y(t,e){return t=(t.nodeType?t:t.el).getBoundingClientRect(),e=e===o?e:(e.nodeType?e:e.el).getBoundingClientRect(),!(t.right<e.left||t.left>e.right||t.top>e.bottom||t.bottom<e.top)}function b(t){for(var e,i,n,a=(new Date).getTime(),r=t&&("IMG"===t.tagName||t.img)?"image":"targets",d=!t,h=W("targets").length,u=0;u<h;u++)y(e=W("targets")[u],o)&&("targets"!==r||t&&t!==e?"image"===r&&y(e,t)&&w(e):(d=!0,w(e)));if("targets"===r&&!d)throw t+" is not a target";i=a,l("Duration: "+(n=(new Date).getTime()-i)+"ms"),n>W("maxDuration")&&(console.log("BackgroundCheck - Killed"),v(),g())}function k(t){var e=function(t){var e=0;return"static"!==window.getComputedStyle(t).position&&(e=parseInt(window.getComputedStyle(t).zIndex,10)||0)>=0&&e++,e},i=t.parentNode;return 1e5*(i?e(i):0)+e(t)}function C(n,a,r){if(t){var g=W("mask");l("--- BackgroundCheck ---"),l("onLoad event: "+(r&&r.src)),!0!==a&&(i.clearRect(0,0,e.width,e.height),i.fillStyle="rgb("+g.r+", "+g.g+", "+g.b+")",i.fillRect(0,0,e.width,e.height));for(var d,h,u=r?[r]:W("images"),m=(x=!1,(w=u).sort(function(t,e){t=t.nodeType?t:t.el,e=e.nodeType?e:e.el;var i=t.compareDocumentPosition(e),n=0;return(t=k(t))>(e=k(e))&&(x=!0),t===e&&2===i?n=1:t===e&&4===i&&(n=-1),n||t-e}),l("Sorted: "+x),x&&l(w),x),s=!1,c=0;c<u.length;c++)y(d=u[c],o)&&(0===(h=d.nodeType?d:d.img).naturalWidth?(s=!0,l("Loading... "+d.src),h.removeEventListener("load",C),m?h.addEventListener("load",C.bind(null,null,!1,null)):h.addEventListener("load",C.bind(null,n,!0,d))):(l("Drawing: "+d.src),void 0,v=f(p=d),p=p.nodeType?p:p.img,v.imageWidth>0&&v.imageHeight>0&&v.width>0&&v.height>0?i.drawImage(p,v.imageLeft,v.imageTop,v.imageWidth,v.imageHeight,v.left,v.top,v.width,v.height):l("Skipping image - "+p.src+" - area too small")));r||s?r&&b(r):b(n)}var p,v,w,x}function x(t){!0===W("windowEvents")&&(n&&clearTimeout(n),n=setTimeout(t,200))}function W(t){if(void 0===r[t])throw"Unknown property - "+t;return r[t]}return{init:function(n){if(void 0===n||void 0===n.targets)throw"Missing attributes";r.debug=d(n.debug,!1),r.debugOverlay=d(n.debugOverlay,!1),r.targets=u(n.targets),r.images=u(n.images||"img",!0),r.changeParent=d(n.changeParent,!1),r.threshold=d(n.threshold,50),r.minComplexity=d(n.minComplexity,30),r.minOverlap=d(n.minOverlap,50),r.windowEvents=d(n.windowEvents,!0),r.maxDuration=d(n.maxDuration,500),r.mask=d(n.mask,{r:0,g:255,b:0}),r.classes=d(n.classes,{dark:"background--dark",light:"background--light",complex:"background--complex"}),void 0===t&&((e=document.createElement("canvas"))&&e.getContext?(i=e.getContext("2d"),t=!0):t=!1,m(),t&&(e.style.position="fixed",e.style.top="0px",e.style.left="0px",e.style.width="100%",e.style.height="100%",window.addEventListener(a,x.bind(null,function(){s(),C()})),window.addEventListener("scroll",x.bind(null,C)),s(),C()))},destroy:g,refresh:C,set:function(t,e){if(void 0===r[t])throw"Unknown property - "+t;if(void 0===e)throw"Missing value for "+t;if("targets"===t||"images"===t)try{e=u("images"!==t||e?e:"img","images"===t)}catch(t){throw e=[],t}else h(e,typeof r[t]);v(),r[t]=e,C(),"debugOverlay"===t&&m()},get:W,getImageData:function(){for(var t,e=W("images"),i=[],n=0;n<e.length;n++)t=f(e[n]),i.push(t);return i}}}),document.addEventListener("DOMContentLoaded",function(){BackgroundCheck.init({targets:".header.header_default"})});